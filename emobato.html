<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Ç®„É¢„Éê„Éà Ê©ü‰Ωì‰∏ÄË¶ß</title>
<style>
:root{
  --bg:#f5f5f5; --card:#fff; --text:#222; --muted:#666; --border:#ccc; --accent:#333; --btn:#eee; --shadow:0 2px 8px rgba(0,0,0,0.1);
}
body.dark{ --bg:#0f1115; --card:#151922; --text:#e6e6e6; --muted:#a3a3a3; --border:#2b2f3a; --accent:#7aa2f7; --btn:#1b2030; --shadow:0 2px 10px rgba(0,0,0,0.35);}
body{ font-family:sans-serif; margin:0; background:var(--bg); color:var(--text); transition:.2s;}
header{background:var(--accent); padding:12px; text-align:center; color:#fff; font-size:1.3em;}
nav{text-align:center; margin:10px 0;}
nav a{color:var(--accent); font-weight:bold; text-decoration:none; font-size:1.1em;}
main{max-width:960px; margin:0 auto; background:var(--card); padding:20px; border-radius:8px; box-shadow:var(--shadow);}
.controls{display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-bottom:15px;}
.controls input,.controls select,.controls button{padding:6px 8px; font-size:14px; border:1px solid var(--border); border-radius:6px; background:var(--card); color:var(--text);}
.event-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px;}
.event-card{border-radius:8px; overflow:hidden; text-align:center; cursor:pointer;}
.event-card img{width:100%; border:1px solid var(--border); border-radius:6px; display:block;}
.event-card div{margin-top:4px; font-size:14px; color:var(--text);}
.search-wrap{position:relative; width:100%; max-width:220px;}
#suggestions{position:absolute; top:100%; left:0; right:0; background:var(--card); border:1px solid var(--border); border-top:none; max-height:220px; overflow-y:auto; z-index:20; display:none;}
#suggestions button{width:100%; text-align:left; background:transparent; border:none; border-bottom:1px solid var(--border); padding:6px 8px; cursor:pointer; color:var(--text);}
#suggestions button:hover{background:var(--btn);}
.muted{color:var(--muted); font-size:12px;}
#scrollTopBtn{position:fixed;bottom:20px;right:20px;display:none;padding:10px;border-radius:50%;border:none;background:var(--accent);color:#fff;cursor:pointer;z-index:50;}
@media (max-width:600px){
  .controls{flex-direction:column; align-items:center;}
  .controls input,.controls select,.controls button{width:90%;}
}
</style>
</head>
<body>

<header>„Ç®„É¢„Éê„Éà Ê©ü‰Ωì‰∏ÄË¶ß</header>
<nav><a href="index.html">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</a></nav>

<main>
<div class="controls">
  <div class="search-wrap">
    <input type="text" id="search" placeholder="Ê©ü‰ΩìÂêç„ÅßÊ§úÁ¥¢">
    <div id="suggestions"></div>
  </div>
  <select id="filterSelect" title="„Ç´„ÉÜ„Ç¥„É™Áµû„ÇäËæº„Åø">
    <option value="">ÂÖ®„Å¶„ÅÆ„Ç´„ÉÜ„Ç¥„É™</option>
    <option value="S1">S1„ÇØ„É©„Çπ</option>
    <option value="S2">S2„ÇØ„É©„Çπ</option>
    <option value="S3">S3„ÇØ„É©„Çπ</option>
  </select>
  <button id="themeToggle" title="„ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàáÊõø">üåô „ÉÄ„Éº„ÇØ</button>
</div>

<div class="event-grid" id="unitList">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
<p class="muted" id="hint"></p>
</main>

<button id="scrollTopBtn">‚Üë</button>

<script>
let units=[], allNames=new Set();

(function initTheme(){ if(localStorage.getItem("emobato_theme")==="dark") document.body.classList.add("dark"); })();

function normalizeForSearch(s){
  if(!s) return "";
  s=s.toLowerCase();
  s=s.replace(/[Ôº°-Ôº∫ÔΩÅ-ÔΩöÔºê-Ôºô]/g,c=>String.fromCharCode(c.charCodeAt(0)-0xFEE0));
  s=s.replace(/[„Ç°-„É≥]/g,c=>String.fromCharCode(c.charCodeAt(0)-0x60));
  s=s.normalize("NFKC");
  return s;
}

async function loadUnits(){
  const listElem=document.getElementById("unitList");
  const unitFiles=["u001.json","u002.json","u003.json"]; // „Åì„Åì„Å´ÂÖ®ÈÉ®„ÅÆJSON„Éï„Ç°„Ç§„É´Âêç„ÇíÂÖ•„Çå„Çã
  units=[];
  for(const f of unitFiles){
    try{
      const res=await fetch("data/units/"+f);
      const u=await res.json();
      units.push(u);
      if(u.name) allNames.add(u.name);
    }catch(e){ console.error(f,e); }
  }
  renderUnits();
}

function renderUnits(){
  const list=document.getElementById("unitList");
  const searchWords=document.getElementById("search").value.trim().split(/\s+/).filter(Boolean).map(normalizeForSearch);
  const filter=document.getElementById("filterSelect").value;
  const filtered=units.filter(u=>{
    const name=normalizeForSearch(u.name||"");
    const keywordMatch=searchWords.length===0 ? true : searchWords.some(w=>name.includes(w));
    const categoryMatch=!filter ? true : (u.class===filter);
    return keywordMatch && categoryMatch;
  });
  document.getElementById("hint").textContent=`${filtered.length}‰ª∂„Éí„ÉÉ„Éà`;
  if(filtered.length===0){ list.innerHTML="<p>Ë©≤ÂΩìÊ©ü‰Ωì„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>"; return; }
  list.innerHTML=filtered.map(u=>{
    return `<div class="event-card" onclick="location.href='unit_detail.html?id=${u.id}'">
      <img src="${u.img}" alt="${u.name}">
      <div>${u.name}</div>
    </div>`;
  }).join('');
}

function showSuggestions(input){
  const box=document.getElementById("suggestions");
  const q=normalizeForSearch(input.trim());
  let items=[];
  if(q){ items=Array.from(allNames).filter(n=>normalizeForSearch(n).includes(q)).slice(0,10); }
  if(items.length===0){ box.style.display="none"; box.innerHTML=""; return; }
  box.innerHTML=items.map(txt=>`<button type="button">${txt}</button>`).join("");
  box.style.display="block";
  box.querySelectorAll("button").forEach(btn=>{
    btn.addEventListener("click",()=>{ const cur=document.getElementById("search").value.trim(); document.getElementById("search").value=cur?cur+" "+btn.textContent:btn.textContent; document.getElementById("search").dispatchEvent(new Event("input")); box.style.display="none"; });
  });
}

document.getElementById("search").addEventListener("input",()=>{ showSuggestions(document.getElementById("search").value); renderUnits(); });
document.getElementById("filterSelect").addEventListener("change",renderUnits);
document.getElementById("themeToggle").addEventListener("click",()=>{document.body.classList.toggle("dark"); const isDark=document.body.classList.contains("dark"); localStorage.setItem("emobato_theme",isDark?"dark":"light"); document.getElementById("themeToggle").textContent=isDark?"‚òÄÔ∏è „É©„Ç§„Éà":"üåô „ÉÄ„Éº„ÇØ";});
document.getElementById("themeToggle").textContent=document.body.classList.contains("dark")?"‚òÄÔ∏è „É©„Ç§„Éà":"üåô „ÉÄ„Éº„ÇØ";

const scrollBtn=document.getElementById("scrollTopBtn");
window.addEventListener("scroll",()=>{ scrollBtn.style.display = window.scrollY>200 ? "block" : "none"; });
scrollBtn.addEventListener("click",()=>{ window.scrollTo({ top:0, behavior:'smooth' }); });

loadUnits();
</script>
</body>
</html>
