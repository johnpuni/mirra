<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>エモモ管理ツール</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background-color: #f5f5f5;
    }
    header {
      background-color: #333;
      padding: 12px;
      text-align: center;
      color: white;
      font-size: 1.3em;
    }
    main {
      max-width: 960px;
      margin: 20px auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .entry {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      position: relative;
    }
    .entry h3 {
      margin-top: 0;
    }
    .entry input,
    .entry textarea {
      width: 100%;
      margin-top: 5px;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .entry .error {
      color: red;
      font-size: 0.9em;
    }
    .remove-button {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      padding: 4px 8px;
    }
    button {
      padding: 10px 16px;
      font-size: 15px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      margin: 5px;
    }
    #jsonOutput {
      white-space: pre-wrap;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      padding: 12px;
      margin-top: 20px;
      border-radius: 6px;
      font-family: monospace;
    }
    #copyBtn {
      background-color: #2980b9;
      color: white;
    }
    #addBtn {
      background-color: #27ae60;
      color: white;
    }
  </style>
</head>
<body>
<header>📦 エモモイベント JSON 作成ツール</header>
<main>
  <div id="entryContainer"></div>
  <button id="addBtn">＋ イベントを追加</button>
  <button onclick="generateJSON()">✅ JSON生成</button>
  <button id="copyBtn" onclick="copyJSON()">📋 コピー</button>
  <div id="jsonOutput"></div>
</main>
<script>
let entryIndex = 0;

function createEntry() {
  const container = document.getElementById("entryContainer");
  const entry = document.createElement("div");
  entry.className = "entry";
  entry.innerHTML = `
    <h3>イベント ${entryIndex + 1}</h3>
    <label>タイトル:</label>
    <textarea class="title"></textarea>
    <label>画像番号（例: 3146）:</label>
    <input type="text" class="img">
    <label>リンク（例: mirr:///notice/r?c=6166）:</label>
    <input type="text" class="link">
    <label>キーワード（カンマ区切り）:</label>
    <input type="text" class="keywords">
    <label>日付（例: 2025-01-01）:</label>
    <input type="date" class="date">
    <div class="error"></div>
    <button class="remove-button" onclick="this.parentElement.remove()">削除</button>
  `;
  container.appendChild(entry);
  entryIndex++;
}

function generateJSON() {
  const entries = document.querySelectorAll(".entry");
  const result = [];
  let hasError = false;

  entries.forEach(entry => {
    const title = entry.querySelector(".title").value.trim();
    const img = entry.querySelector(".img").value.trim();
    const link = entry.querySelector(".link").value.trim();
    const keywords = entry.querySelector(".keywords").value.trim();
    const date = entry.querySelector(".date").value;
    const errorDiv = entry.querySelector(".error");
    errorDiv.textContent = "";

    if (!title || !img || !link || !keywords || !date) {
      errorDiv.textContent = "すべての項目を入力してください。";
      hasError = true;
      return;
    }

    if (!/^\d+$/.test(img)) {
      errorDiv.textContent = "画像番号が不正です。数字のみで入力してください。";
      hasError = true;
      return;
    }

    if (!/^mirr:\/\/\/notice\/r\?c=\d+$/.test(link)) {
      errorDiv.textContent = "リンクの形式が不正です。";
      hasError = true;
      return;
    }

    const keywordArray = keywords.split(",").map(k => k.trim()).filter(k => k);
    if (keywordArray.length === 0) {
      errorDiv.textContent = "キーワードを1つ以上入力してください。";
      hasError = true;
      return;
    }

    result.push({
      title: title,
      img: "images/" + img + ".webp",
      link: link,
      keywords: keywordArray,
      date: date
    });
  });

  if (!hasError) {
    document.getElementById("jsonOutput").textContent = JSON.stringify(result, null, 2);
  } else {
    document.getElementById("jsonOutput").textContent = "";
  }
}

function copyJSON() {
  const json = document.getElementById("jsonOutput").textContent;
  navigator.clipboard.writeText(json).then(() => {
    alert("JSONをコピーしました！");
  });
}

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("addBtn").addEventListener("click", createEntry);
  createEntry();
});
</script>
</body>
</html>
