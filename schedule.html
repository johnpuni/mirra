<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mirrativ Event Schedule</title>
<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#0e0e11;
  color:#fff;
  margin:0;
  padding:0;
  overflow-x:hidden;
}
h1{
  text-align:center;
  margin:20px 0;
}
#password-screen, #schedule-screen{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  background:#0e0e11;
  z-index:999;
}
#password-screen input[type="password"]{
  font-size:1.5rem;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  border:none;
  width:250px;
  text-align:center;
}
#password-screen button{
  margin-top:20px;
  padding:10px 20px;
  font-size:1rem;
  border-radius:6px;
  border:none;
  cursor:pointer;
  background:#1a1b20;
  color:#fff;
}
#password-screen p{
  max-width:400px;
  text-align:center;
  margin:10px 0;
  opacity:.8;
}
.version{
  position:absolute;
  bottom:10px;
  font-size:12px;
  opacity:.5;
}
#schedule{
  padding:16px;
}
.tabs{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:12px;
}
.tab{
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  background:#1a1b20;
  opacity:.7;
}
.tab.active{
  background:#ff6;
  color:#000;
  opacity:1;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px;
}
.card{
  background:#1a1b20;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,.4);
  transition: transform .2s;
}
.card:hover{ transform: scale(1.03);}
.image-box{
  width:100%;
  aspect-ratio:4/3;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  cursor:pointer;
  position:relative;
}
.image-box img{
  width:100%;
  height:100%;
  object-fit:contain;
}
.time{
  padding:6px;
  font-size:12px;
  text-align:center;
  opacity:.8;
}
.status{
  position:absolute;
  top:6px;
  left:6px;
  background:rgba(255,255,255,.8);
  color:#000;
  font-size:10px;
  padding:2px 4px;
  border-radius:4px;
  font-weight:bold;
}
.current{
  box-shadow:0 0 12px 4px #ff0 inset;
  animation: glow 1.5s infinite alternate;
}
@keyframes glow{
  from{box-shadow:0 0 12px 4px #ff0 inset;}
  to{box-shadow:0 0 24px 8px #ff0 inset;}
}
/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal{
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center; align-items:center;
  z-index:1000;
}
.modal img{ max-width:90%; max-height:90%; }
.modal:target{ display:flex; }
</style>
</head>
<body>
<div id="password-screen">
  <h1>ãƒªãƒ¼ã‚¯æƒ…å ±é–²è¦§ã®ãŸã‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</h1>
  <p>ã“ã®ãƒšãƒ¼ã‚¸ã«ã¯æœªå…¬é–‹æƒ…å ±ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆå†…éƒ¨æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚é–¢ä¿‚è€…ä»¥å¤–ã®é–²è¦§ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
  <input type="password" id="pw-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
  <button onclick="checkPassword()">Enter</button>
  <div class="version">Version 1.0.0</div>
</div>

<div id="schedule-screen" style="display:none;">
  <h1>ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
  <div class="tabs" id="month-tabs"></div>
  <div id="schedule" class="grid"></div>
  <div class="version">Version 1.0.1</div>
</div>

<div id="modal" class="modal">
  <img id="modal-img">
</div>

<script>
const PASSWORD="johnleak";
const VERSION="1.0.0";

// ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
function checkPassword(){
  const val=document.getElementById("pw-input").value;
  if(val===PASSWORD){
    localStorage.setItem("auth",VERSION);
    showSchedule();
  } else {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
  }
}
function showSchedule(){
  document.getElementById("password-screen").style.display="none";
  document.getElementById("schedule-screen").style.display="block";
}

// æ›´æ–°ãƒã‚§ãƒƒã‚¯
if(localStorage.getItem("auth")!==VERSION){
  document.getElementById("password-screen").style.display="flex";
  document.getElementById("schedule-screen").style.display="none";
} else {
  showSchedule();
}

// ğŸ“¦ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
async function loadSchedule(){
  const listRes = await fetch("schedule/index.json");
  const files = await listRes.json();
  let events = [];
  for(const file of files){
    const res = await fetch("schedule/"+file);
    const data = await res.json();
    events = events.concat(data);
  }

  // é‡è¤‡å‰Šé™¤ï¼ˆURLãƒ»ç”»åƒãƒ»æ—¥ä»˜ï¼‰
  const uniqueEvents = [];
  const seen = new Set();
  for(const e of events){
    const key = e.url+e.image+e.start+e.end;
    if(!seen.has(key)){ seen.add(key); uniqueEvents.push(e); }
  }

  render(uniqueEvents);
}

// ğŸ–¼ æç”»
function render(events){
  const wrap=document.getElementById("schedule");

  // æœˆã‚¿ãƒ–ä½œæˆ
  const months = [...new Set(events.map(e=>new Date(e.start).getMonth()+"-"+new Date(e.start).getFullYear()))]
    .map(m=>{
      const [mon, yr] = m.split("-");
      return {month:parseInt(mon), year:parseInt(yr)};
    }).sort((a,b)=> b.year - a.year || b.month - a.month);

  const tabs=document.getElementById("month-tabs");
  months.forEach((m,i)=>{
    const tab=document.createElement("div");
    tab.className="tab";
    tab.textContent=`${m.year}å¹´${m.month+1}æœˆ`;
    tab.onclick=()=> filterMonth(m.month, m.year);
    if(i===0) tab.classList.add("active");
    tabs.appendChild(tab);
  });

  // åˆæœŸè¡¨ç¤ºï¼šæœ€æ–°æœˆ
  const latest = months[0];
  filterMonth(latest.month, latest.year);

  function filterMonth(month, year){
    wrap.innerHTML="";
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    const activeTab = Array.from(document.querySelectorAll(".tab")).find(t=>t.textContent===`${year}å¹´${month+1}æœˆ`);
    if(activeTab) activeTab.classList.add("active");

    const now=new Date();
    events.filter(e=>{
      const d=new Date(e.start);
      return d.getMonth()===month && d.getFullYear()===year;
    }).forEach(e=>{
      const card=document.createElement("div");
      card.className="card";

      const box=document.createElement("div");
      box.className="image-box";

      // çŠ¶æ…‹è¡¨ç¤º
      const s=new Date(e.start), f=new Date(e.end);
      let status="", extraClass="";
      if(now<s){
        const diff=Math.ceil((s-now)/(1000*60*60*24));
        status=`é–‹å§‹ã¾ã§ã‚ã¨${diff}æ—¥`;
      } else if(now>=s && now<=f){
        status="é–‹å‚¬ä¸­";
        extraClass="current";
      } else {
        status="çµ‚äº†";
        box.style.opacity=0.4;
      }

      const stDiv=document.createElement("div");
      stDiv.className="status";
      stDiv.textContent=status;
      box.appendChild(stDiv);

      // ç”»åƒ
      if(e.image){
        const img=document.createElement("img");
        img.src=e.image;
        img.onclick=()=> {
          document.getElementById("modal-img").src=e.image;
          location.hash="modal";
        }
        box.appendChild(img);
      } else { box.textContent="No Image"; }

      if(extraClass) box.classList.add(extraClass);

      const time=document.createElement("div");
      time.className="time";
      time.textContent=new Date(e.start).toLocaleDateString()+" ï½ "+new Date(e.end).toLocaleDateString();

      card.append(box,time);
      wrap.appendChild(card);
    });
  }
}

loadSchedule();

// ã‚¹ã‚¯ã‚·ãƒ§é˜²æ­¢ï¼ˆåˆ¶é™çš„ï¼‰
document.addEventListener("contextmenu",e=>e.preventDefault());
document.addEventListener("keydown",e=>{
  if(e.ctrlKey && ["s","S","p","P","i","I"].includes(e.key)) e.preventDefault();
});
</script>
</body>
</html>
