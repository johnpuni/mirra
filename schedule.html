<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mirrativ Event Schedule</title>

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#0e0e11;
  color:#fff;
  margin:0;
  padding:0;
}
h1{
  text-align:center;
  margin:20px 0;
}
#schedule{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(160px,1fr));
  gap:14px;
  padding:16px;
}
.card{
  background:#1a1b20;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 6px 14px rgba(0,0,0,.4);
}
.image-box{
  aspect-ratio:1/1;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.image-box img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.time{
  padding:8px;
  font-size:12px;
  text-align:center;
  opacity:.8;
}
</style>
</head>
<body>

<h1>ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
<div id="schedule"></div>

<script>
// ðŸ” ç”»åƒãƒ—ãƒ­ã‚­ã‚·ï¼ˆCORSå¯¾ç­–ï¼‰
function proxyImage(url){
  return "https://images.weserv.nl/?url=" +
         encodeURIComponent(url.replace(/^https?:\/\//, ""));
}

// ðŸ”— Mirrativç›´é€šãƒªãƒ³ã‚¯
function directLink(url){
  return "mirr://webview/window/open?url=" + encodeURIComponent(url);
}

// ðŸ“¦ JSONèª­ã¿è¾¼ã¿
async function loadSchedule(){
  const listRes = await fetch("schedule/index.json");
  const files = await listRes.json();

  let events = [];

  for(const file of files){
    const res = await fetch("schedule/" + file);
    const data = await res.json();
    events = events.concat(data);
  }

  render(events);
}

// ðŸ–¼ æç”»
function render(events){
  const wrap = document.getElementById("schedule");

  events.sort((a,b)=> new Date(a.start) - new Date(b.start));

  for(const e of events){
    const card = document.createElement("div");
    card.className = "card";

    const box = document.createElement("div");
    box.className = "image-box";
    box.onclick = ()=> location.href = directLink(e.url);

    if(e.image){
      const img = document.createElement("img");
      img.src = proxyImage(e.image);
      box.appendChild(img);
    }else{
      box.textContent = "No Image";
    }

    const time = document.createElement("div");
    time.className = "time";
    time.textContent =
      new Date(e.start).toLocaleDateString() + " ï½ž " +
      new Date(e.end).toLocaleDateString();

    card.append(box, time);
    wrap.appendChild(card);
  }
}

loadSchedule();
</script>
</body>
</html>

