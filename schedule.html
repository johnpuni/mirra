<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mirrativ Event Schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#0e0e11;color:#fff;margin:0;padding:0;user-select:none;}
h1{text-align:center;margin:20px 0;}
#month-tabs{display:flex;flex-wrap:wrap;justify-content:center;margin:8px 0;}
.tab{padding:8px 16px;margin:4px;background:#222;border-radius:8px;cursor:pointer;transition:all .3s;}
.tab.active{background:#ff6;color:#000;font-weight:bold;}
#schedule{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;padding:16px;opacity:0;transition:opacity .5s;}
.card{background:#1a1b20;border-radius:14px;overflow:hidden;box-shadow:0 6px 14px rgba(0,0,0,.4);transition:transform .3s,box-shadow .3s,opacity .5s;position:relative;}
.card:hover{transform:scale(1.05);box-shadow:0 12px 20px rgba(0,0,0,.5);}
.image-box{aspect-ratio:1/1;background:#000;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;}
.image-box img{width:100%;height:100%;object-fit:cover;}
.time{padding:8px;font-size:14px;text-align:center;opacity:.9;}
.open-btn{position:absolute;bottom:8px;right:8px;background:#ff6;font-weight:bold;color:#000;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:16px;z-index:2;}
.open-btn:hover{background:#ff8;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:999;display:none;}
.modal{position:relative;background:#000;border-radius:12px;max-width:90%;max-height:90%;overflow:hidden;}
.modal img{width:100%;height:auto;object-fit:contain;display:block;}
.close-btn{position:absolute;top:10px;right:10px;font-size:36px;font-weight:bold;color:#fff;background:rgba(0,0,0,.5);padding:6px 12px;border-radius:8px;cursor:pointer;}
@keyframes glow{0%{box-shadow:0 0 8px #0f0;}50%{box-shadow:0 0 20px #0f0;}100%{box-shadow:0 0 8px #0f0;}}
.glow{animation:glow 1.2s infinite;}
.past{opacity:0.4;}
.fade-in{opacity:0;transform:translateY(10px);animation:fadeIn 0.5s forwards;}
@keyframes fadeIn{to{opacity:1;transform:translateY(0);}}

#pw-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#111;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:1000;}
#pw-screen input{font-size:28px;padding:14px;margin:12px;border-radius:8px;border:none;text-align:center;width:260px;}
#pw-screen button{font-size:24px;padding:12px 18px;margin-top:12px;border-radius:8px;border:none;background:#ff6;color:#000;cursor:pointer;}
#pw-screen button:hover{background:#ff8;}
#pw-screen .info{text-align:center;margin-top:20px;font-size:16px;line-height:1.5;max-width:380px;}
#pw-screen #pw-version{position:absolute;bottom:10px;font-size:14px;color:#888;}

#screenshot-warning{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);color:#f00;display:flex;align-items:center;justify-content:center;text-align:center;font-size:24px;padding:20px;z-index:2000;display:none;}
#version{position:fixed;bottom:4px;right:8px;font-size:12px;color:#888;}
@media(max-width:900px){#schedule{grid-template-columns:repeat(2,1fr);}}
@media(max-width:600px){#schedule{grid-template-columns:repeat(1,1fr);}}
</style>
</head>
<body>

<div id="screenshot-warning">スクリーンショットは許可されていません！</div>

<div id="pw-screen">
<h1>リーク情報閲覧のためパスワードが必要です</h1>
<input type="password" id="pw" placeholder="Password">
<button onclick="checkPassword()">Enter</button>
<div class="info">
このページには未公開情報・イベント内部情報が含まれています。<br>
関係者以外の閲覧は禁止されています。
</div>
<div id="pw-version">Version 1.0.7</div>
</div>

<h1>イベントスケジュール</h1>
<div id="month-tabs"></div>
<div id="schedule"></div>

<div class="overlay" id="modal">
  <div class="modal">
    <span class="close-btn" onclick="closeModal()">×</span>
    <img id="modal-img" src="">
  </div>
</div>

<div id="version">Version 1.0.7 / 更新日: 2026-01-06</div>

<script>
const PASSWORD="johnleak";
const VERSION="1.0.7";

// パスワード管理（バージョンが変わったら再入力）
if(localStorage.getItem("pw_ok")!==PASSWORD || localStorage.getItem("pw_version")!==VERSION){
  document.getElementById("pw-screen").style.display="flex";
}

function checkPassword(){
  const val=document.getElementById("pw").value;
  if(val===PASSWORD){
    localStorage.setItem("pw_ok",PASSWORD);
    localStorage.setItem("pw_version",VERSION);
    document.getElementById("pw-screen").style.display="none";
  }else{alert("パスワードが違います");}
}

function proxyImage(url){return "https://images.weserv.nl/?url="+encodeURIComponent(url.replace(/^https?:\/\//,""));}
function directLink(url){return "mirr://webview/window/open?url="+encodeURIComponent(url);}

let allEvents=[];
async function loadSchedule(){
  const listRes=await fetch("schedule/index.json");
  const files=await listRes.json();
  for(const file of files){
    const res=await fetch("schedule/"+file);
    const data=await res.json();
    allEvents=allEvents.concat(data);
  }
  const seen={};
  allEvents=allEvents.filter(e=>{
    const key=e.url+"|"+e.start+"|"+e.end;
    if(seen[key]) return false;
    seen[key]=true;
    return true;
  });
  setupMonthTabs();
}

function setupMonthTabs(){
  const months=[...new Set(allEvents.map(e=>e.start.slice(0,7)))].sort();
  const tabsWrap=document.getElementById("month-tabs");
  tabsWrap.innerHTML="";
  months.forEach((m,i)=>{
    const tab=document.createElement("div");
    tab.className="tab";
    tab.textContent=m;
    tab.onclick=()=>{document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));tab.classList.add("active");renderMonth(m);}
    tabsWrap.appendChild(tab);
  });
  const latest=months[months.length-1];
  const activeTab=[...tabsWrap.children].find(t=>t.textContent===latest);
  if(activeTab) activeTab.classList.add("active");
  renderMonth(latest);
}

function renderMonth(month){
  const wrap=document.getElementById("schedule");
  wrap.innerHTML="";
  const now=new Date();
  const events=allEvents.filter(e=>e.start.startsWith(month));
  events.sort((a,b)=> new Date(a.start)-new Date(b.start));
  events.forEach((e,i)=>{
    const start=new Date(e.start),end=new Date(e.end);
    const card=document.createElement("div");
    card.className="card fade-in";
    card.style.animationDelay=(i*0.05)+"s";
    if(now>end) card.classList.add("past");
    else if(now>=start && now<=end) card.classList.add("glow");

    const box=document.createElement("div");
    box.className="image-box";
    box.onclick=()=>openModal(e.image.replace("catalog_banner","hero"));
    if(e.image){const img=document.createElement("img");img.src=proxyImage(e.image);box.appendChild(img);}
    else box.textContent="No Image";

    const time=document.createElement("div");
    time.className="time";
    if(now<start){const days=Math.ceil((start-now)/86400000);time.textContent="開始まであと"+days+"日";}
    else if(now>=start && now<=end){const days=Math.ceil((end-now)/86400000);time.textContent="終了まであと"+days+"日";}
    else{time.textContent="終了済み";}

    const btn=document.createElement("div");
    btn.className="open-btn";
    btn.textContent="開く";
    btn.onclick=(ev)=>{ev.stopPropagation();location.href=directLink(e.url);};

    card.append(box,time,btn);
    wrap.appendChild(card);
  });
  wrap.style.opacity="1";
}

// モーダル
function openModal(src){document.getElementById("modal-img").src=proxyImage(src);document.getElementById("modal").style.display="flex";}
function closeModal(){document.getElementById("modal").style.display="none";}
document.addEventListener("keydown",e=>{if(e.key==="Escape") closeModal();});

// スケジュールロード
loadSchedule();

// スクショ防止
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('copy', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.ctrlKey && ["c","C","s","S","p","P"].includes(e.key)){
    e.preventDefault();
    document.getElementById("screenshot-warning").style.display="flex";
    setTimeout(()=>document.getElementById("screenshot-warning").style.display="none",3000);
  }
});
</script>
</body>
</html>
