<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mirrativ Event Schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* åŸºæœ¬ */
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#0e0e11;color:#fff;margin:0;padding:0;user-select:none;}
h1{text-align:center;margin:20px 0;}
#schedule{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;padding:14px;}
.card{background:#1a1b20;border-radius:14px;overflow:hidden;box-shadow:0 6px 14px rgba(0,0,0,.4);position:relative;transition:transform .3s,box-shadow .3s;}
.card:hover{transform:scale(1.03);box-shadow:0 12px 20px rgba(0,0,0,.5);}
.image-box{aspect-ratio:1/1;background:#000;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;border-radius:12px;}
.image-box img{width:100%;height:100%;object-fit:cover;}
.time-circle{position:absolute;top:8px;right:8px;width:48px;height:48px;background:#ff6;color:#000;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;text-align:center;line-height:1.2;box-shadow:0 0 6px rgba(255,255,0,0.7);}
.time-circle.glow{animation:glow 1.2s infinite;}
.time{padding:8px;font-size:14px;text-align:center;opacity:.9;}
.open-btn{position:absolute;bottom:8px;right:8px;background:#ff6;font-weight:bold;color:#000;padding:6px 12px;border-radius:8px;cursor:pointer;font-size:14px;z-index:2;}
.open-btn:hover{background:#ff8;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:999;display:none;}
.modal{position:relative;background:#000;border-radius:12px;max-width:90%;max-height:90%;overflow:hidden;display:flex;align-items:center;justify-content:center;}
.modal img{max-width:100%;max-height:100%;object-fit:contain;display:block;}
.close-btn{position:absolute;top:10px;right:10px;font-size:36px;font-weight:bold;color:#fff;background:rgba(0,0,0,.5);padding:6px 12px;border-radius:8px;cursor:pointer;}
@keyframes glow{0%{box-shadow:0 0 6px #0f0;}50%{box-shadow:0 0 16px #0f0;}100%{box-shadow:0 0 6px #0f0;}}
.past{opacity:0.4;}

/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»é¢ */
#pw-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#111;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:1000;}
#pw-screen input{font-size:28px;padding:14px;margin:12px;border-radius:8px;border:none;text-align:center;width:260px;}
#pw-screen button{font-size:24px;padding:12px 18px;margin-top:12px;border-radius:8px;border:none;background:#ff6;color:#000;cursor:pointer;}
#pw-screen button:hover{background:#ff8;}
#pw-screen .info{text-align:center;margin-top:20px;font-size:16px;line-height:1.5;max-width:380px;}
#pw-screen #pw-version{position:absolute;bottom:10px;font-size:14px;color:#888;}

/* ã‚¹ã‚¯ã‚·ãƒ§é˜²æ­¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
#screenshot-warning{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);color:#f00;display:flex;align-items:center;justify-content:center;text-align:center;font-size:24px;padding:20px;z-index:2000;display:none;}
#version{position:fixed;bottom:4px;right:8px;font-size:12px;color:#888;}
</style>
</head>
<body>

<div id="screenshot-warning">
ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼
</div>

<div id="pw-screen">
<h1>ãƒªãƒ¼ã‚¯æƒ…å ±é–²è¦§ã®ãŸã‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</h1>
<input type="password" id="pw" placeholder="Password">
<button onclick="checkPassword()">Enter</button>
<div class="info">
ã“ã®ãƒšãƒ¼ã‚¸ã«ã¯æœªå…¬é–‹æƒ…å ±ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆå†…éƒ¨æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚<br>
é–¢ä¿‚è€…ä»¥å¤–ã®é–²è¦§ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚
</div>
<div id="pw-version">Version 1.1.2</div>
</div>

<h1>ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
<div id="schedule"></div>

<div class="overlay" id="modal">
  <div class="modal">
    <span class="close-btn" onclick="closeModal()">Ã—</span>
    <img id="modal-img" src="">
  </div>
</div>

<div id="version">Version 1.1.2 / æ›´æ–°æ—¥: 2026-01-06</div>

<script>
// ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
const PASSWORD = "johnleak";
const CURRENT_VERSION = "1.1.2";
if(localStorage.getItem("pw_ok") !== PASSWORD+"_"+CURRENT_VERSION){
  document.getElementById("pw-screen").style.display = "flex";
}
function checkPassword(){
  const val = document.getElementById("pw").value;
  if(val === PASSWORD){
    localStorage.setItem("pw_ok", PASSWORD+"_"+CURRENT_VERSION);
    document.getElementById("pw-screen").style.display = "none";
  }else{
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
  }
}

// ğŸ” ç”»åƒãƒ—ãƒ­ã‚­ã‚·
function proxyImage(url){return "https://images.weserv.nl/?url="+encodeURIComponent(url.replace(/^https?:\/\//,""));}
// ğŸ”— Mirrativç›´é€šãƒªãƒ³ã‚¯
function directLink(url){return "mirr://webview/window/open?url="+encodeURIComponent(url);}

// ğŸ“¦ JSONèª­ã¿è¾¼ã¿
async function loadSchedule(){
  const listRes = await fetch("schedule/index.json");
  const files = await listRes.json();
  let events = [];
  for(const file of files){
    const res = await fetch("schedule/"+file);
    const data = await res.json();
    events = events.concat(data);
  }
  // é‡è¤‡URLã‚„åŒæ—¥ä»˜ã¯ã¾ã¨ã‚ã‚‹
  const seen = {};
  events = events.filter(e=>{
    const key = e.url+"|"+e.start+"|"+e.end;
    if(seen[key]) return false;
    seen[key]=true;
    return true;
  });
  render(events);
}

// ğŸ–¼ æç”»
function render(events){
  const wrap = document.getElementById("schedule");
  wrap.innerHTML="";
  events.sort((a,b)=> new Date(a.start) - new Date(b.start));
  const now = new Date();

  for(const e of events){
    const start = new Date(e.start);
    const end = new Date(e.end);
    const card = document.createElement("div");
    card.className="card";

    const box = document.createElement("div");
    box.className="image-box";

    // éå»ãƒ»é–‹å‚¬ä¸­ãƒ»é–‹å‚¬å‰
    let text="";
    if(now<start){
      const days = Math.ceil((start-now)/86400000);
      text="é–‹å§‹ã¾ã§\n"+days+"æ—¥";
    }else if(now>=start && now<=end){
      const days = Math.ceil((end-now)/86400000);
      text="çµ‚äº†ã¾ã§\n"+days+"æ—¥";
      card.querySelector?card.classList.add("glow"):card.classList.add("glow");
    }else{
      text="çµ‚äº†æ¸ˆã¿";
      card.classList.add("past");
    }

    const circle = document.createElement("div");
    circle.className="time-circle";
    if(now>=start && now<=end) circle.classList.add("glow");
    circle.textContent=text;
    box.appendChild(circle);

    box.onclick = ()=> openModal(e.image.replace("catalog_banner","hero"));
    if(e.image){
      const img = document.createElement("img");
      img.src = proxyImage(e.image);
      box.appendChild(img);
    }else box.textContent="No Image";

    // é–‹ããƒœã‚¿ãƒ³
    const btn = document.createElement("div");
    btn.className="open-btn";
    btn.textContent="é–‹ã";
    btn.onclick = (ev)=>{ev.stopPropagation(); location.href = directLink(e.url);};

    card.append(box,btn);
    wrap.appendChild(card);
  }
}

// ğŸ”˜ ãƒ¢ãƒ¼ãƒ€ãƒ«
function openModal(src){
  const modalImg = document.getElementById("modal-img");
  modalImg.src="";
  document.getElementById("modal").style.display="flex";
  // èª­ã¿è¾¼ã¿ä¸­
  const loader = document.createElement("div");
  loader.textContent="èª­ã¿è¾¼ã¿ä¸­...";
  loader.style.color="#fff";
  loader.style.fontSize="18px";
  loader.style.textAlign="center";
  loader.style.position="absolute";
  loader.style.top="50%";
  loader.style.left="50%";
  loader.style.transform="translate(-50%,-50%)";
  loader.id="modal-loader";
  document.getElementById("modal").appendChild(loader);

  const img = new Image();
  img.src = proxyImage(src);
  img.onload = ()=>{
    modalImg.src = img.src;
    const l = document.getElementById("modal-loader");
    if(l) l.remove();
  }
}
function closeModal(){document.getElementById("modal").style.display="none";}
document.addEventListener("keydown",e=>{if(e.key==="Escape") closeModal();});

// ğŸ–¥ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ‰
loadSchedule();

// ğŸ›‘ ã‚¹ã‚¯ã‚·ãƒ§é˜²æ­¢
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('copy', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.ctrlKey && ["c","C","s","S","p","P"].includes(e.key)) {
    e.preventDefault();
    document.getElementById("screenshot-warning").style.display="flex";
    setTimeout(()=>document.getElementById("screenshot-warning").style.display="none",3000);
  }
});
</script>
</body>
</html>
