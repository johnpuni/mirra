<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mirrativ Event Schedule</title>

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#0e0e11;
  color:#fff;
  margin:0;
  padding:0;
  transition: filter 0.3s;
}
.locked body{
  filter: blur(12px);
  pointer-events: none;
  user-select: none;
}
h1{
  text-align:center;
  margin:20px 0;
}
#schedule{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(180px,1fr));
  gap:14px;
  padding:16px;
}
.card{
  background:#1a1b20;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 6px 14px rgba(0,0,0,.4);
}
.image-box{
  aspect-ratio:1/1;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.image-box img{
  width:100%;
  height:100%;
  object-fit:contain; /* cover â†’ contain ã«å¤‰æ›´ã§å…¨ä½“è¡¨ç¤º */
}
.time{
  padding:8px;
  font-size:12px;
  text-align:center;
  opacity:.8;
}

/* ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»é¢ */
#lock{
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
#lock h2{
  color:#ff5555;
  margin-bottom:20px;
  font-size:24px;
}
#pw{
  font-size:20px;
  padding:8px;
  width:220px;
  text-align:center;
}
#unlockBtn{
  margin-top:12px;
  padding:8px 16px;
  font-size:16px;
  cursor:pointer;
  background:#ff5555;
  border:none;
  border-radius:8px;
  color:#fff;
}
</style>
</head>
<body>

<h1>ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
<div id="schedule"></div>

<!-- ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ -->
<div id="lock" style="display:none;">
  <h2>Access Restricted</h2>
  <input type="password" id="pw" placeholder="Enter Password" />
  <button id="unlockBtn">Unlock</button>
</div>

<script>
// === è¨­å®š ===
const SITE_VERSION = "2026-01-06-v1"; // æ›´æ–°ã”ã¨ã«æ›¸ãæ›ãˆ
const PASSWORD = "johnleak";

// ğŸ” ç”»åƒãƒ—ãƒ­ã‚­ã‚·ï¼ˆCORSå¯¾ç­–ï¼‰
function proxyImage(url){
  return "https://images.weserv.nl/?url=" +
         encodeURIComponent(url.replace(/^https?:\/\//, ""));
}

// ğŸ”— Mirrativç›´é€šãƒªãƒ³ã‚¯
function directLink(url){
  return "mirr://webview/window/open?url=" + encodeURIComponent(url);
}

// === èªè¨¼ ===
function checkAuth() {
  const auth = localStorage.getItem("mirra_auth");
  if(auth !== SITE_VERSION){
    showLock();
  }
}
function showLock(){
  const lock = document.getElementById("lock");
  lock.style.display = "flex";
  document.body.classList.add("locked");
}
function unlock(){
  const pw = document.getElementById("pw");
  if(pw.value === PASSWORD){
    localStorage.setItem("mirra_auth", SITE_VERSION);
    document.getElementById("lock").style.display="none";
    document.body.classList.remove("locked");
  } else {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
  }
}
document.getElementById("unlockBtn").addEventListener("click", unlock);
document.getElementById("pw").addEventListener("keyup",(e)=>{if(e.key==="Enter") unlock();});

// === ã‚¹ã‚¯ã‚·ãƒ§æŠ‘æ­¢ ===
document.addEventListener("keydown", (e)=>{
  if(e.key === "PrintScreen" || (e.ctrlKey && e.key.toLowerCase() === "p")){
    e.preventDefault();
    alert("ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚„å°åˆ·ã¯ç¦æ­¢ã§ã™");
  }
});
window.addEventListener("blur", ()=>{document.body.style.filter="blur(12px)";});
window.addEventListener("focus", ()=>{document.body.style.filter="none";});

// === JSONèª­ã¿è¾¼ã¿ ===
async function loadSchedule(){
  const listRes = await fetch("schedule/index.json");
  const files = await listRes.json();

  let events = [];

  for(const file of files){
    const res = await fetch("schedule/" + file);
    const data = await res.json();
    events = events.concat(data);
  }

  render(events);
}

// === æç”» ===
function render(events){
  const wrap = document.getElementById("schedule");

  // é‡è¤‡å‰Šé™¤ï¼ˆåŒURLã€åŒç”»åƒURLã€åŒæ—¥ä»˜ï¼‰
  const seen = new Set();
  events = events.filter(e=>{
    const key = e.url + e.image + e.start + e.end;
    if(seen.has(key)) return false;
    seen.add(key);
    return true;
  });

  const now = new Date();

  events.sort((a,b)=> new Date(a.start) - new Date(b.start));

  for(const e of events){
    const card = document.createElement("div");
    card.className = "card";

    // é–‹å‚¬ä¸­/äºˆå®š/çµ‚äº†
    const start = new Date(e.start);
    const end = new Date(e.end);
    let status = "";
    if(now >= start && now <= end) status = "ğŸŸ¢"; // é–‹å‚¬ä¸­
    else if(now < start) status = "ğŸ•“";           // é–‹å‚¬äºˆå®š
    else status = "ğŸ—‘ï¸";                         // çµ‚äº†

    const box = document.createElement("div");
    box.className = "image-box";
    box.onclick = ()=> location.href = directLink(e.url);

    if(e.image){
      const img = document.createElement("img");
      img.src = proxyImage(e.image);
      box.appendChild(img);
    }else{
      box.textContent = "No Image";
    }

    const time = document.createElement("div");
    time.className = "time";
    time.textContent = `${status} ${start.toLocaleDateString()} ï½ ${end.toLocaleDateString()}`;

    card.append(box, time);
    wrap.appendChild(card);
  }
}

// === åˆæœŸåŒ– ===
window.addEventListener("load", ()=>{
  checkAuth();
  loadSchedule();
});
</script>

</body>
</html>
