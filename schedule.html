<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mirrativ Event Schedule</title>

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#0e0e11;
  color:#fff;
  margin:0;
  padding:0;
  transition: filter 0.3s;
}
.locked body{
  filter: blur(12px);
  pointer-events: none;
  user-select: none;
}
h1{
  text-align:center;
  margin:20px 0;
}
#schedule{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(180px,1fr));
  gap:14px;
  padding:16px;
}
.card{
  background:#1a1b20;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 6px 14px rgba(0,0,0,.4);
}
.image-box{
  aspect-ratio:1/1;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.image-box img{
  width:100%;
  height:100%;
  object-fit:contain; /* ÂÖ®‰ΩìË°®Á§∫ */
}
.time{
  padding:8px;
  font-size:12px;
  text-align:center;
  opacity:.8;
}

/* üîí „Éë„Çπ„ÉØ„Éº„ÉâÁîªÈù¢ */
#lock{
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
#lock h2{
  color:#ff5555;
  margin-bottom:30px;
  font-size:32px; /* Â§ß„Åç„Åè */
}
#pw{
  font-size:28px; /* Â§ß„Åç„Åè */
  padding:12px;
  width:300px;
  text-align:center;
  border-radius:8px;
  border:none;
}
#unlockBtn{
  margin-top:16px;
  padding:12px 24px;
  font-size:20px;
  cursor:pointer;
  background:#ff5555;
  border:none;
  border-radius:12px;
  color:#fff;
}
#version{
  margin-top:20px;
  font-size:14px;
  color:#888;
}
</style>
</head>
<body>

<h1>„Ç§„Éô„É≥„Éà„Çπ„Ç±„Ç∏„É•„Éº„É´</h1>
<div id="schedule"></div>

<!-- üîí „Éë„Çπ„ÉØ„Éº„Éâ„É≠„ÉÉ„ÇØ -->
<div id="lock" style="display:none;">
  <h2>Access Restricted</h2>
  <input type="password" id="pw" placeholder="Enter Password" />
  <button id="unlockBtn">Unlock</button>
  <div id="version">v2026-01-06-v1</div>
</div>

<script>
// === Ë®≠ÂÆö ===
const SITE_VERSION = "2026-01-06-v1"; // Êõ¥Êñ∞„Åî„Å®„Å´Êõ∏„ÅçÊèõ„Åà
const PASSWORD = "johnleak";

// üîÅ ÁîªÂÉè„Éó„É≠„Ç≠„Ç∑ÔºàCORSÂØæÁ≠ñÔºâ
function proxyImage(url){
  return "https://images.weserv.nl/?url=" +
         encodeURIComponent(url.replace(/^https?:\/\//, ""));
}

// üîó MirrativÁõ¥ÈÄö„É™„É≥„ÇØ
function directLink(url){
  return "mirr://webview/window/open?url=" + encodeURIComponent(url);
}

// === Ë™çË®º ===
function checkAuth() {
  const auth = localStorage.getItem("mirra_auth");
  if(auth !== SITE_VERSION){
    showLock();
  }
}
function showLock(){
  const lock = document.getElementById("lock");
  lock.style.display = "flex";
  document.body.classList.add("locked");
}
function unlock(){
  const pw = document.getElementById("pw");
  if(pw.value === PASSWORD){
    localStorage.setItem("mirra_auth", SITE_VERSION);
    document.getElementById("lock").style.display="none";
    document.body.classList.remove("locked");
  } else {
    alert("„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô");
  }
}
document.getElementById("unlockBtn").addEventListener("click", unlock);
document.getElementById("pw").addEventListener("keyup",(e)=>{if(e.key==="Enter") unlock();});

// === „Çπ„ÇØ„Ç∑„ÉßÊäëÊ≠¢ ===
document.addEventListener("keydown", (e)=>{
  if(e.key === "PrintScreen" || (e.ctrlKey && e.key.toLowerCase() === "p")){
    e.preventDefault();
    alert("„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„ÇÑÂç∞Âà∑„ÅØÁ¶ÅÊ≠¢„Åß„Åô");
  }
});
window.addEventListener("blur", ()=>{document.body.style.filter="blur(12px)";});
window.addEventListener("focus", ()=>{document.body.style.filter="none";});

// === JSONË™≠„ÅøËæº„Åø ===
async function loadSchedule(){
  const listRes = await fetch("schedule/index.json");
  const files = await listRes.json();

  let events = [];

  for(const file of files){
    const res = await fetch("schedule/" + file);
    const data = await res.json();
    events = events.concat(data);
  }

  render(events);
}

// === ÊèèÁîª ===
function render(events){
  const wrap = document.getElementById("schedule");

  // ÈáçË§áÂâäÈô§ÔºàÂêåURL„ÄÅÂêåÁîªÂÉèURL„ÄÅÂêåÊó•‰ªòÔºâ
  const seen = new Set();
  events = events.filter(e=>{
    const key = e.url + e.image + e.start + e.end;
    if(seen.has(key)) return false;
    seen.add(key);
    return true;
  });

  const now = new Date();

  events.sort((a,b)=> new Date(a.start) - new Date(b.start));

  for(const e of events){
    const card = document.createElement("div");
    card.className = "card";

    // ÈñãÂÇ¨‰∏≠/‰∫àÂÆö/ÁµÇ‰∫Ü
    const start = new Date(e.start);
    const end = new Date(e.end);
    let status = "";
    if(now >= start && now <= end) status = "üü¢"; // ÈñãÂÇ¨‰∏≠
    else if(now < start) status = "üïì";           // ÈñãÂÇ¨‰∫àÂÆö
    else status = "üóëÔ∏è";                         // ÁµÇ‰∫Ü

    const box = document.createElement("div");
    box.className = "image-box";
    box.onclick = ()=> location.href = directLink(e.url);

    if(e.image){
      const img = document.createElement("img");
      img.src = proxyImage(e.image);
      box.appendChild(img);
    }else{
      box.textContent = "No Image";
    }

    const time = document.createElement("div");
    time.className = "time";
    time.textContent = `${status} ${start.toLocaleDateString()} ÔΩû ${end.toLocaleDateString()}`;

    card.append(box, time);
    wrap.appendChild(card);
  }
}

// === ÂàùÊúüÂåñ ===
window.addEventListener("load", ()=>{
  checkAuth();
  loadSchedule();
});
</script>

</body>
</html>
