<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Mirrativ Event Schedule</title>

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#0e0e11;
  color:#fff;
  margin:0;
}
h1{text-align:center;margin:16px 0}
#tabs{display:flex;gap:8px;justify-content:center;margin-bottom:10px;flex-wrap:wrap}
.tab{padding:6px 14px;border-radius:20px;background:#1a1b20;cursor:pointer;font-size:13px}
.tab.active{background:#3b82f6}

#schedule{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
  padding:14px;
}

.card{background:#1a1b20;border-radius:14px;overflow:hidden}
.image-box{
  height:160px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:black;
  cursor:pointer
}
.image-box img{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
}
.time{text-align:center;font-size:12px;padding:6px}
.badge{text-align:center;font-size:12px;margin-bottom:6px}
.running{color:#22c55e}
.upcoming{color:#60a5fa}
.ended{color:#9ca3af}

/* ğŸ” Lock */
#lock{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#050508,#141423);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9;
}
#lockBox{
  background:#1a1b20;
  padding:42px 38px;
  border-radius:22px;
  width:380px;
  max-width:90%;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}
#lockBox h2{font-size:24px;margin-bottom:10px}
#lockBox p{font-size:13px;opacity:.8;margin-bottom:18px}
#lockBox input{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  font-size:16px;
}
#lockBox button{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:none;
  margin-top:16px;
  background:#3b82f6;
  color:white;
  font-size:16px;
  cursor:pointer;
}
#lockBox button:hover{opacity:.9}
</style>
</head>
<body>

<div id="lock">
  <div id="lockBox">
    <h2>ãƒªãƒ¼ã‚¯æƒ…å ±é–²è¦§ã®ãŸã‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</h2>
    <p>ã“ã®ãƒšãƒ¼ã‚¸ã«ã¯æœªå…¬é–‹æƒ…å ±ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆå†…éƒ¨æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚<br>
    é–¢ä¿‚è€…ä»¥å¤–ã®é–²è¦§ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
    <input id="pw" type="password" placeholder="Password">
    <button onclick="unlock()">Access</button>
  </div>
</div>

<h1>ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
<div id="tabs"></div>
<div id="schedule"></div>

<script>
const PASSWORD="johnleak";
const SITE_VERSION="2026-01-06"; // â† æ›´æ–°ã—ãŸã‚‰ã“ã®æ—¥ä»˜ã‚’å¤‰ãˆã‚‹

if(localStorage.getItem("mirra_auth")!==SITE_VERSION){
  document.getElementById("lock").style.display="flex";
}

function unlock(){
  if(pw.value===PASSWORD){
    localStorage.setItem("mirra_auth",SITE_VERSION);
    document.getElementById("lock").style.display="none";
  }else alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
}

function direct(url){
  location.href="mirr://webview/window/open?url="+encodeURIComponent(url)
}

async function load(){
  const files=await (await fetch("schedule/index.json")).json();
  let events=[];
  for(const f of files){
    const d=await (await fetch("schedule/"+f)).json();
    events.push(...d);
  }

  const map=new Map();
  events.forEach(e=>{
    const k=e.url+e.image+e.start+e.end;
    if(!map.has(k))map.set(k,e);
  });
  events=[...map.values()].sort((a,b)=>new Date(a.start)-new Date(b.start));

  const now=new Date();
  const months=[...new Set(events.map(e=>e.start.slice(0,7)))];
  const tabs=document.getElementById("tabs");
  const wrap=document.getElementById("schedule");

  function draw(month){
    wrap.innerHTML="";
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.getElementById("tab_"+month).classList.add("active");

    events.filter(e=>e.start.startsWith(month)).forEach(e=>{
      const s=new Date(e.start), en=new Date(e.end);
      let status="çµ‚äº†",cls="ended";
      if(now>=s && now<=en){status="é–‹å‚¬ä¸­";cls="running"}
      else if(now<s){status="é–‹å‚¬äºˆå®š";cls="upcoming"}

      const c=document.createElement("div");
      c.className="card";
      c.innerHTML=`
        <div class="image-box" onclick="direct('${e.url}')">
          <img src="${e.image}">
        </div>
        <div class="badge ${cls}">${status}</div>
        <div class="time">${s.toLocaleDateString()} ï½ ${en.toLocaleDateString()}</div>
      `;
      wrap.appendChild(c);
    });
  }

  months.forEach(m=>{
    const t=document.createElement("div");
    t.className="tab";
    t.id="tab_"+m;
    t.textContent=m;
    t.onclick=()=>draw(m);
    tabs.appendChild(t);
  });

  const latest=months.sort().reverse()[0];
  draw(latest);
}

load();
</script>
</body>
</html>
