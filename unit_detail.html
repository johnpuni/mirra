<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ¦ãƒ‹ãƒƒãƒˆæ”»ç•¥ã‚µã‚¤ãƒˆé¢¨</title>
<style>
:root{
  --bg:#f5f5f5; --card:#fff; --text:#222; --muted:#666; --border:#ccc; --accent:#333;
  --btn:#eee; --shadow:0 2px 8px rgba(0,0,0,0.1);
  --attack:#f28c8c; --defense:#8cc7f2; --movement:#8cf29c;
}
body.dark{
  --bg:#0f1115; --card:#1a1e27; --text:#e6e6e6; --muted:#a3a3a3; --border:#2b2f3a; --accent:#7aa2f7;
  --btn:#1b2030; --shadow:0 2px 10px rgba(0,0,0,0.35);
  --attack:#f77; --defense:#4aa; --movement:#4a7;
}
body{
  margin:0; font-family:sans-serif; background:var(--bg); color:var(--text); transition:.2s; padding:20px;
}
h1{margin-bottom:10px; text-align:center;}
img.unitImg{
  max-width:300px; width:100%; border-radius:10px; display:block; margin:0 auto 15px auto; box-shadow: var(--shadow); cursor:pointer;
}
.controls{display:flex; justify-content:flex-end; margin-bottom:15px;}
button{padding:6px 10px; border:none; border-radius:5px; cursor:pointer; background:var(--btn); transition:.2s;}
button:hover{opacity:.8;}
a{color:var(--accent); text-decoration:none; font-weight:bold; display:inline-block; margin-top:15px;}
a:hover{text-decoration:underline;}
.card-container{display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-bottom:20px;}
.card{background:var(--card); border-radius:10px; box-shadow:var(--shadow); padding:15px; width:320px; transition:.2s;}
.card:hover{transform:scale(1.03);}
.card h3{margin-top:0; margin-bottom:10px; font-size:1.2em; text-align:center;}
.card ul{list-style:none; padding:0; margin:0;}
.card li{margin-bottom:5px; line-height:1.4;}
.attack{border-left:4px solid var(--attack); padding-left:8px;}
.defense{border-left:4px solid var(--defense); padding-left:8px;}
.movement{border-left:4px solid var(--movement); padding-left:8px;}
.modal{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000;}
.modal img{max-width:90%; max-height:90%; border-radius:10px;}
</style>
</head>
<body>

<div class="controls">
  <button id="themeToggle">ğŸŒ™ ãƒ€ãƒ¼ã‚¯åˆ‡æ›¿</button>
</div>

<h1>ãƒ¦ãƒ‹ãƒƒãƒˆæ”»ç•¥</h1>
<div class="card-container" id="unitsContainer">
  <!-- å„ãƒ¦ãƒ‹ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
</div>

<a href="unit_list.html">â† ä¸€è¦§ã«æˆ»ã‚‹</a>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal" id="imgModal">
  <img id="modalImg" src="" alt="">
</div>

<script>
// ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆæœŸåŒ–
(function initTheme(){
  if(localStorage.getItem("emobo_theme")==="dark") document.body.classList.add("dark");
})();
document.getElementById("themeToggle").addEventListener("click",()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("emobo_theme",document.body.classList.contains("dark")?"dark":"light");
});

// æ”»ç•¥ç”¨ç¿»è¨³ãƒãƒƒãƒ—
const translations = {
  aircraftName:"æ©Ÿä½“å", description:"èª¬æ˜",
  moveSpeed:"ç§»å‹•é€Ÿåº¦", moveAccel:"åŠ é€Ÿåº¦", moveBrake:"ãƒ–ãƒ¬ãƒ¼ã‚­", rotationSpeed:"æ—‹å›é€Ÿåº¦", defense:"é˜²å¾¡åŠ›", searchHitRadius:"ç´¢æ•µç¯„å›²",
  memo:"æ­¦å™¨å", weaponCategry:"æ­¦å™¨ã‚«ãƒ†ã‚´ãƒª", attackPower:"æ”»æ’ƒåŠ›", attackTimeSpan:"æ”»æ’ƒé–“éš”", attackHitRadius:"æ”»æ’ƒç¯„å›²",
  gradeType:"ãƒ©ãƒ³ã‚¯", buffType:"åŠ¹æœç¨®é¡", buffPower:"åŠ¹æœå€¤", buffDuration:"åŠ¹æœæ™‚é–“", buffProbability:"ç™ºå‹•ç¢ºç‡", targetType:"å¯¾è±¡ã‚¿ã‚¤ãƒ—",
  useChargeWhenFire:"ãƒãƒ£ãƒ¼ã‚¸ç™ºå°„", useChargeWithoutFire:"ãƒãƒ£ãƒ¼ã‚¸ã®ã¿", maxChargeTime:"æœ€å¤§ãƒãƒ£ãƒ¼ã‚¸æ™‚é–“", inChargeFx:"ãƒãƒ£ãƒ¼ã‚¸ä¸­FX",
  disableChargeEffectWhenMax:"æœ€å¤§æ™‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç„¡åŠ¹", img:"ç”»åƒ"
};

// å€¤æ•´å½¢é–¢æ•°
function formatValue(val){
  if(val==null) return "-";
  if(typeof val==="number") return (Math.abs(val)%1===0)? val : val.toFixed(2);
  if(typeof val==="string") return val;
  if(Array.isArray(val)){
    const ul=document.createElement("ul");
    val.forEach(v=>{
      const li=document.createElement("li");
      if(typeof v==="object") li.appendChild(formatObject(v));
      else li.textContent=v;
      ul.appendChild(li);
    });
    return ul;
  }
  if(typeof val==="object") return formatObject(val);
  return val;
}

function formatObject(obj){
  const ul=document.createElement("ul");
  Object.keys(obj).forEach(k=>{
    const v=obj[k];
    if(typeof v==="object" && v!==null){
      const li=document.createElement("li");
      li.textContent = (translations[k]||k)+":";
      li.appendChild(formatValue(v));
      ul.appendChild(li);
    } else {
      const li=document.createElement("li");
      li.textContent = (translations[k]||k) + ": " + v;
      ul.appendChild(li);
    }
  });
  return ul;
}

// ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ«
const modal=document.getElementById("imgModal");
const modalImg=document.getElementById("modalImg");
function setupModal(imgEl){
  imgEl.addEventListener("click",()=>{
    modal.style.display="flex";
    modalImg.src=imgEl.src;
  });
}
modal.addEventListener("click",()=>modal.style.display="none");

// JSONèª­ã¿è¾¼ã¿
fetch('units/all.json')
  .then(res=>res.json())
  .then(units=>{
    const container=document.getElementById("unitsContainer");
    units.forEach(unit=>{
      const card=document.createElement("div");
      card.className="card";

      // ã‚¿ã‚¤ãƒˆãƒ«
      const title=document.createElement("h3");
      title.textContent=unit.aircraftName||"åç§°ä¸æ˜";
      card.appendChild(title);

      // ç”»åƒ
      const img=document.createElement("img");
      img.className="unitImg";
      img.src=unit.img||"images/default.png";
      setupModal(img);
      card.appendChild(img);

      // èª¬æ˜
      if(unit.description){
        const desc=document.createElement("p");
        desc.textContent=unit.description;
        card.appendChild(desc);
      }

      // æ©Ÿä½“ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      const statsUl=document.createElement("ul");
      for(const key in unit){
        if(["aircraftName","description","img","weaponSettings","passiveSkills","KobanBuffList","specialMoves"].includes(key)) continue;
        if(translations[key]){
          const li=document.createElement("li");
          li.textContent = translations[key]+": "+unit[key];
          statsUl.appendChild(li);
        }
      }
      // ç‰¹æ®Šç§»å‹•
      if(unit.specialMoves && unit.specialMoves.length){
        const li=document.createElement("li");
        li.textContent = "ç‰¹æ®Šç§»å‹•: " + unit.specialMoves.join(", ");
        statsUl.appendChild(li);
      }
      card.appendChild(statsUl);

      // æ­¦å™¨è¨­å®š
      if(unit.weaponSettings){
        const weaponCard=document.createElement("div");
        weaponCard.className="card attack";
        const wh3=document.createElement("h3"); wh3.textContent="æ­¦å™¨";
        weaponCard.appendChild(wh3);
        const weaponUl=document.createElement("ul");
        for(const key in unit.weaponSettings){
          if(translations[key]){
            const li=document.createElement("li");
            li.textContent = translations[key]+": "+unit.weaponSettings[key];
            weaponUl.appendChild(li);
          }
        }
        weaponCard.appendChild(weaponUl);
        card.appendChild(weaponCard);
      }

      // ãƒ‘ãƒƒã‚·ãƒ–ã‚¹ã‚­ãƒ«
      if(unit.passiveSkills && unit.passiveSkills.length){
        const passiveCard=document.createElement("div");
        passiveCard.className="card defense";
        const ph3=document.createElement("h3"); ph3.textContent="ãƒ‘ãƒƒã‚·ãƒ–ã‚¹ã‚­ãƒ«";
        passiveCard.appendChild(ph3);
        unit.passiveSkills.forEach((skill,i)=>{
          const liTitle=document.createElement("li");
          liTitle.textContent = "--- ã‚¹ã‚­ãƒ«"+(i+1)+" ---";
          const skillUl=formatObject(skill);
          passiveCard.appendChild(liTitle);
          passiveCard.appendChild(skillUl);
        });
        card.appendChild(passiveCard);
      }

      // KobanBuffListãªã©ç‰¹æ®Šãƒãƒ•
      if(unit.KobanBuffList && unit.KobanBuffList.length){
        const buffCard=document.createElement("div");
        buffCard.className="card defense";
        const bh3=document.createElement("h3"); bh3.textContent="ç‰¹æ®Šãƒãƒ•";
        buffCard.appendChild(bh3);
        unit.KobanBuffList.forEach((buff,i)=>{
          const li=document.createElement("li");
          li.textContent = `#${i+1} ${buff.tag} / åŠ¹æœ: ${buff.buffParam} / æ™‚é–“: ${buff.buffDuration}`;
          buffCard.appendChild(li);
        });
        card.appendChild(buffCard);
      }

      container.appendChild(card);
    });
  })
  .catch(err=>console.error(err));
