<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ユニット詳細（ギャラリー風）</title>
<style>
:root{
  --bg:#f5f5f5; --card:#fff; --text:#222; --muted:#666; --border:#ccc; --accent:#333;
  --btn:#eee; --shadow:0 2px 8px rgba(0,0,0,0.1);
  --attack:#f28c8c; --defense:#8cc7f2; --movement:#8cf29c;
}
body.dark{
  --bg:#0f1115; --card:#1a1e27; --text:#e6e6e6; --muted:#a3a3a3; --border:#2b2f3a; --accent:#7aa2f7;
  --btn:#1b2030; --shadow:0 2px 10px rgba(0,0,0,0.35);
  --attack:#f77; --defense:#4aa; --movement:#4a7;
}
body{
  margin:0; font-family:sans-serif; background:var(--bg); color:var(--text); transition:.2s; padding:20px;
}
h1{margin-bottom:10px;}
img#unitImg{
  max-width:300px; width:100%; border-radius:10px; display:block; margin:0 auto 15px auto; box-shadow: var(--shadow); cursor:pointer;
}
.controls{display:flex; justify-content:flex-end; margin-bottom:15px;}
button{padding:6px 10px; border:none; border-radius:5px; cursor:pointer; background:var(--btn); transition:.2s;}
button:hover{opacity:.8;}
a{color:var(--accent); text-decoration:none; font-weight:bold; display:inline-block; margin-top:15px;}
a:hover{text-decoration:underline;}
.card-container{display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-bottom:20px;}
.card{background:var(--card); border-radius:10px; box-shadow:var(--shadow); padding:15px; width:260px; transition:.2s;}
.card:hover{transform:scale(1.03);}
.card h3{margin-top:0; margin-bottom:10px; font-size:1.1em;}
.card ul{list-style:none; padding:0; margin:0;}
.card li{margin-bottom:5px;}
.attack{border-left:4px solid var(--attack); padding-left:8px;}
.defense{border-left:4px solid var(--defense); padding-left:8px;}
.movement{border-left:4px solid var(--movement); padding-left:8px;}

/* モーダル用 */
.modal{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000;}
.modal img{max-width:90%; max-height:90%; border-radius:10px;}
</style>
</head>
<body>

<div class="controls">
  <button id="themeToggle">🌙 ダーク切替</button>
</div>

<h1 id="unitName">読み込み中…</h1>
<img id="unitImg" src="" alt="">

<p id="unitDesc"></p>

<div class="card-container">
  <div class="card movement">
    <h3>性能</h3>
    <ul id="unitStats"></ul>
  </div>
  <div class="card attack">
    <h3>武器</h3>
    <ul id="weaponStats"></ul>
  </div>
  <div class="card defense">
    <h3>パッシブスキル</h3>
    <ul id="passiveSkills"></ul>
  </div>
</div>

<a href="unit_list.html">← 一覧に戻る</a>

<!-- モーダル -->
<div class="modal" id="imgModal">
  <img id="modalImg" src="" alt="">
</div>

<script>
// ダークモード初期化
(function initTheme(){
  if(localStorage.getItem("emobo_theme")==="dark") document.body.classList.add("dark");
})();
document.getElementById("themeToggle").addEventListener("click",()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("emobo_theme",document.body.classList.contains("dark")?"dark":"light");
});

// URLからユニットID取得
const params = new URLSearchParams(location.search);
const id = params.get('id');

if(id){
  fetch(`units/${id}.json`)
    .then(res=>res.json())
    .then(data=>{
      const m = data.machine;
      const w = data.weapon;
      const p = data.passiveSkills;

      // 機体名・説明・画像
      document.getElementById("unitName").textContent = m.aircraftName;
      document.getElementById("unitDesc").textContent = m.description;
      const unitImg = document.getElementById("unitImg");
      unitImg.src = m.img || "images/default.png";
      unitImg.alt = m.aircraftName;

      // 性能
      const statsUl = document.getElementById("unitStats");
      statsUl.innerHTML = "";
      const performance = {
        "移動速度": m.moveSpeed,
        "加速度": m.moveAccel,
        "慣性抵抗": m.moveResistPower,
        "ブレーキ": m.moveBrake,
        "防御力": m.defense,
        "リスポーン速度": m.respawnPositionSelectMoveSpeed,
        "索敵範囲": m.searchHitRadius
      };
      for(const key in performance){
        const li = document.createElement("li");
        li.textContent = `${key}: ${performance[key] != null ? performance[key].toFixed(1) : "-"}`;
        statsUl.appendChild(li);
      }

      // 武器
      const weaponUl = document.getElementById("weaponStats");
      weaponUl.innerHTML = "";
      const weaponStats = {
        "武器名": w.memo,
        "攻撃力": w.attackPower,
        "攻撃範囲": w.attackMoveRange,
        "ヒット半径": w.attackHitRadius,
        "攻撃時間": w.attackDuration,
        "攻撃間隔": w.attackTimeSpan
      };
      for(const key in weaponStats){
        const li = document.createElement("li");
        const value = weaponStats[key] != null && typeof weaponStats[key] === "number" ? weaponStats[key].toFixed(2) : weaponStats[key];
        li.textContent = `${key}: ${value}`;
        weaponUl.appendChild(li);
      }

      // パッシブスキル
      const passiveUl = document.getElementById("passiveSkills");
      passiveUl.innerHTML = "";
      p.forEach(skill=>{
        const li = document.createElement("li");
        const effect = skill.attackPower != null ? `効果値: ${skill.attackPower.toFixed(1)}` : "-";
        li.textContent = `${skill.memo} (${effect})`;
        passiveUl.appendChild(li);
      });

    })
    .catch(err=>{
      console.error(err);
      document.getElementById("unitName").textContent = "データ読み込み失敗";
    });
}else{
  document.getElementById("unitName").textContent = "IDが指定されていません";
}

// 画像クリックでモーダル表示
const modal = document.getElementById("imgModal");
const modalImg = document.getElementById("modalImg");
unitImg.addEventListener("click", ()=>{
  modal.style.display = "flex";
  modalImg.src = unitImg.src;
});
modal.addEventListener("click", ()=>{
  modal.style.display = "none";
});
</script>

</body>
</html>
