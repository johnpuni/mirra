<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ユニット詳細</title>
<style>
:root{
  --bg:#f5f5f5; --card:#fff; --text:#222; --muted:#666; --border:#ccc; --accent:#333; --btn:#eee; --shadow:0 2px 8px rgba(0,0,0,0.1);
}
body.dark{
  --bg:#0f1115;
  --card:#1a1e27;
  --text:#e6e6e6;
  --muted:#a3a3a3;
  --border:#2b2f3a;
  --accent:#7aa2f7;
  --btn:#1b2030;
  --shadow:0 2px 10px rgba(0,0,0,0.35);
}
body{
  margin:0; font-family:sans-serif; background:var(--bg); color:var(--text); transition:.2s; padding:20px;
}
h1,h2{margin:10px 0;}
img{max-width:100%; border-radius:8px; margin:10px 0;}
table{
  width:100%; border-collapse:collapse; margin-bottom:15px;
  box-shadow: var(--shadow);
}
th,td{
  border:1px solid var(--border); padding:8px; text-align:left;
}
th{
  background:var(--btn); font-weight:bold;
}
tbody tr:nth-child(even){background:var(--bg);}
.controls{display:flex; justify-content:flex-end; margin-bottom:15px;}
button{
  padding:6px 10px; border:none; border-radius:5px; cursor:pointer; background:var(--btn);
  transition:.2s;
}
button:hover{opacity:.8;}
a{
  color:var(--accent); text-decoration:none; font-weight:bold;
  display:inline-block; margin-top:10px;
}
a:hover{text-decoration:underline;}
</style>
</head>
<body>

<div class="controls">
  <button id="themeToggle">🌙 ダーク切替</button>
</div>

<h1 id="unitName">読み込み中…</h1>
<img id="unitImg" src="" alt="">
<p id="unitDesc"></p>

<h2>性能</h2>
<table id="unitStats">
  <thead><tr><th>項目</th><th>値</th></tr></thead>
  <tbody></tbody>
</table>

<h2>武器</h2>
<table id="weaponStats">
  <thead><tr><th>項目</th><th>値</th></tr></thead>
  <tbody></tbody>
</table>

<h2>パッシブスキル</h2>
<table id="passiveSkills">
  <thead><tr><th>スキル名</th><th>効果</th></tr></thead>
  <tbody></tbody>
</table>

<a href="unit_list.html">← 一覧に戻る</a>

<script>
// ダークモード初期化
(function initTheme(){
  if(localStorage.getItem("emobo_theme")==="dark") document.body.classList.add("dark");
})();
document.getElementById("themeToggle").addEventListener("click",()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("emobo_theme",document.body.classList.contains("dark")?"dark":"light");
});

// URLからユニットID取得
const params = new URLSearchParams(location.search);
const id = params.get('id');

if(id){
  fetch(`units/${id}.json`)
    .then(res=>res.json())
    .then(data=>{
      const m = data.machine;
      const w = data.weapon;
      const p = data.passiveSkills;

      // 機体名・説明
      document.getElementById("unitName").textContent = m.aircraftName;
      document.getElementById("unitDesc").textContent = m.description;
      document.getElementById("unitImg").src = m.img || "";
      document.getElementById("unitImg").alt = m.aircraftName;

      // 性能
      const statsTbody = document.getElementById("unitStats").querySelector("tbody");
      statsTbody.innerHTML = "";
      const performance = {
        "移動速度": m.moveSpeed,
        "加速度": m.moveAccel,
        "慣性抵抗": m.moveResistPower,
        "ブレーキ": m.moveBrake,
        "回転速度": m.rotationSpeed,
        "防御力": m.defense,
        "リスポーン速度": m.respawnPositionSelectMoveSpeed,
        "索敵範囲": m.searchHitRadius
      };
      for(const key in performance){
        const tr = document.createElement("tr");
        const value = performance[key] != null ? performance[key].toFixed(1) : "-";
        tr.innerHTML = `<td>${key}</td><td>${value}</td>`;
        statsTbody.appendChild(tr);
      }

      // 武器
      const weaponTbody = document.getElementById("weaponStats").querySelector("tbody");
      weaponTbody.innerHTML = "";
      const weaponStats = {
        "武器名": w.memo,
        "攻撃力": w.attackPower,
        "攻撃範囲": w.attackMoveRange,
        "ヒット半径": w.attackHitRadius,
        "攻撃時間": w.attackDuration
      };
      for(const key in weaponStats){
        const tr = document.createElement("tr");
        const value = weaponStats[key] != null && typeof weaponStats[key] === "number" ? weaponStats[key].toFixed(1) : weaponStats[key];
        tr.innerHTML = `<td>${key}</td><td>${value}</td>`;
        weaponTbody.appendChild(tr);
      }

      // パッシブスキル
      const passiveTbody = document.getElementById("passiveSkills").querySelector("tbody");
      passiveTbody.innerHTML = "";
      p.forEach(skill=>{
        const tr = document.createElement("tr");
        const effect = skill.attackPower != null ? `効果値: ${skill.attackPower.toFixed(1)}` : "-";
        tr.innerHTML = `<td>${skill.memo}</td><td>${effect}</td>`;
        passiveTbody.appendChild(tr);
      });

    })
    .catch(err=>{
      console.error(err);
      document.getElementById("unitName").textContent = "データ読み込み失敗";
    });
}else{
  document.getElementById("unitName").textContent = "IDが指定されていません";
}
</script>

</body>
</html>
